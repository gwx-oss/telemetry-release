---
name: telemetry-centralizer

provides:
- name: telemetry-centralizer
  type: telemetry-agent-connection
  properties:
  - port
  - tls.ca_cert

templates:
  bpm.yml.erb: config/bpm.yml
  telemetry_centralizer.erb: bin/telemetry_centralizer
  config.erb: config/fluent.cnf
  ca_cert.pem.erb: config/ca_cert.pem
  cert.pem.erb: config/cert.pem
  private_key.pem.erb: config/private_key.pem
  curl_config.erb: config/curl_config

packages:
- fluentd
- ruby-2.4-r5

properties:
  telemetry.api_key:
    description: Bearer token for authenticating against telemetry endpoint
  telemetry.endpoint:
    description: HTTP endpoint to send telemetry batches to
  flush_interval:
    default: 3600
    description: Time in seconds for the Centralizer to forward a telemetry batch
  port:
    default: 24224
    description: Port to listen on for fluent forward protocol
  tls.cert:
    description: TLS Certificate for the Centralizer
  tls.private_key:
    description: TLS Private Key for the Centralizer
  tls.ca_cert:
    description: TLS CA for telemetry certificates
